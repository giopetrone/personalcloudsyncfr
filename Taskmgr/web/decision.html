<!--<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
-->
<html> <!--</html> xmlns="http://www.w3.org/1999/xhtml">-->
<head>
<title>Edit Decision</title>

<!-- TinyMCE -->
<script type="text/javascript" src="./js/tiny_mce/tiny_mce.js"></script>
<script language="JavaScript" src="./js/Jalava.js"></script>
         <script language="JavaScript">

 var trovati = new Array();
 var archi = new Array();
            function dado(){
                try{
                var jsonString = window.parent.Jalava.diagram.persist();
                
                var id = window.parent.TextEdit.target.parentNode.parentNode.id;
               
                var persisted = JSON.parse(jsonString);
                var blocks = persisted.blocks.length;
                var connections = persisted.connections.length;
                
               
                var j =0;
               
                for(var i=0;i<connections;i++)
                {
                    var source = persisted.connections[i].source;
                  
                   
                    if(source == id) {
                        trovati[j] = persisted.connections[i];
                      
                        j++;
                       

                    }
                }
                if(trovati.length !=0)
                {

                    //selectElement = document.createElement("select");
                   // selectElement.setAttribute("id", "status");
                   // selectElement.setAttribute("name","status");
                  //  document.forms[0].appendChild(selectElement);
                  //  labelElement = document.createElement("label");
                  //  label.text = "Go to Task";
                    for(var h=0;h<trovati.length;h++)
                    {
                       
                        var value = "";
                        var id = trovati[h].target;
                        for(var l=0;l<blocks;l++)
                        {
                            var blockid = persisted.blocks[l].id;
                            
                            if(blockid == id)
                            {
                                var blockname = persisted.blocks[l].name;
                                var blockfig = persisted.blocks[l].imageId;
                                if(blockname == null && blockfig == "rect") blockname = "Click To Edit";
                                else if (blockname == null && blockfig == "diamond") blockname = "Decision";
                                value = "Vai al nodo "+ blockname;
                            }
                        }
                        var add = document.getElementById("status");


                        
                          add.removeChild(add.firstChild);
                       


                        currentElement = document.createElement("option");

                        currentElement.setAttribute("id", id);

                        currentElement.value = id;
                        currentElement.text = value;
                        document.myform.status.appendChild(currentElement);
                    }
                }
                
            }catch(e){e.message;}
        }


        


      </script>
<script type="text/javascript">
function go() {
  try {
    if (window.parent.TextEdit) {
      var data = window.parent.TextEdit.getCurrentDesc();
      //document.forms['myform'].elements['elm1'].value = data;
      tinyMCE.activeEditor.setContent(data);
    }
  } 
  catch (e) {
    alert(e.message);
  }
}


tinyMCE.init({
    mode : "textareas",
    theme : "advanced",
    theme_advanced_buttons1 : "fontselect,fontsizeselect,forecolor,separator,bold,italic,underline,justifyleft,justifycenter,justifyright,justifyfull",
    theme_advanced_buttons2 : "",
    theme_advanced_buttons3 : "",
    theme_advanced_toolbar_location : "top",
    theme_advanced_toolbar_align : "left",
	theme_advanced_more_colors : 0,
	setup : function(ed) {
      ed.onInit.add(go);
    }
});



function initDesc(oForm, element_name) {

frmElement = oForm.elements[element_name];

frmElement.value = window.parent.TextEdit.getCurrentDesc();



}



function initConnection(oForm, element_name) {

frmElement = oForm.elements[element_name];

frmElement.value = dado();
alert("value: "+frmElement.value);


}


 function permission(){
        var writers = parent.TextEdit.target.parentNode.parentNode.writers;
        var own = parent.TextEdit.target.parentNode.parentNode.owner;
        
        var logged = parent.document.getElementById("owner").value;
     
      
        if(writers == null) writers == '';
        if(own != logged && writers.indexOf(logged)==-1 )
          {

             document.myform.status.disabled = true;
             document.myform.elm.disabled = true;

          }


        }
function done()
{
    
    var size = document.forms[0].length;
   
    if(size != 4) ;
    else window.parent.TextEdit.close();
    
}

function initForm(oForm, element_name) {

frmElement = oForm.elements[element_name];
frmElement.value = window.parent.TextEdit.getCurrentContent();

}

<!-- /TinyMCE -->
</script>

</head>
<body onload="initForm(document.forms[0],'nome');initDesc(document.forms[0],'elm1');go();dado();permission();" style="background: white;" >

<form name='myform'>



	<label class="desc" id="title106" for="Field106">
		Name
			</label>
	
		<input id ="nome" name="nome" type="text"/>
			

	<!-- Gets replaced with TinyMCE, remember HTML in a textarea should be encoded -->
	<textarea id="elm1" name="elm1" rows="15" style="width: 90%">
	</textarea>

        <div id="cont" name="cont">
       
            <label> Select a task to go </label>
            <select id="status" name="status">
            <option id="empty" name="empty"> </option>
            </select>

		

	</div>
        <div>
	 <input type="button" name="ok" value="OK" onclick="window.parent.TextEdit.setContentDecision(tinyMCE.activeEditor.getContent(),document.forms[0].status.value,document.forms[0].nome.value);" />
	 <input type="button" name="reset" value="Cancel" onclick="window.parent.TextEdit.close()"/>
        </div>
        
</form>

</body>
</html>
