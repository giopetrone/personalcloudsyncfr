<!--<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
-->
<html> <!--</html> xmlns="http://www.w3.org/1999/xhtml">-->
<head>
<title>Edit Decision</title>

<!-- TinyMCE -->
<script type="text/javascript" src="./js/tiny_mce/tiny_mce.js"></script>
<script language="JavaScript" src="./js/Jalava.js"></script>
         <script language="JavaScript">

 var trovati = new Array();
            function dado(){
                try{
                var jsonString = window.parent.Jalava.diagram.persist();
                
                var id = window.parent.TextEdit.target.parentNode.parentNode.id;
               
                var persisted = JSON.parse(jsonString);
                var blocks = persisted.blocks.length;
                var connections = persisted.connections.length;
                
               
                var j =0;
                for(var i=0;i<connections;i++)
                {
                    var source = persisted.connections[i].source;
                  
                   
                    if(source == id) {
                        trovati[j] = persisted.connections[i];
                        
                        j++;

                    }
                }
            for(var h=0;h<trovati.length;h++)
            {
                var value = "Vai al Nodo "+trovati[h].target;
                var id = trovati[h].target;
        
              
                var name = "conn "+h;
                currentElement = document.createElement("option");
                
                currentElement.setAttribute("id", id);
            
                currentElement.value = id;
                currentElement.text = value;
                document.forms[0].status.appendChild(currentElement);
            }
            }catch(e){e.message;}
        }


        function color()
        {
            var size = window.parent.TextEdit.target.parentNode.parentNode.parentNode.childNodes.length;
            
            var option = document.forms[0].status.value;
           // alert(option);
            for(var i=20;i<size;i++)
            {
                var conn = window.parent.TextEdit.target.parentNode.parentNode.parentNode.childNodes[i].id;

                if(option == conn) {
                    var colorCode = "#008000";
                    alert(trovati[0].color);
                   
                    var segments = window.parent.TextEdit.target.parentNode.parentNode.parentNode.childNodes[i].childNodes.length;
                     for(var j=3;j<segments;j++){
                     window.parent.TextEdit.target.parentNode.parentNode.parentNode.childNodes[i].childNodes[j].style.borderColor = "green";
                     window.parent.TextEdit.target.parentNode.parentNode.parentNode.childNodes[i].childNodes[j].style.backgroundColor = colorCode;
                    
                 }
                }
            }
        }


      </script>
<script type="text/javascript">
function go() {
  try {
    if (window.parent.TextEdit) {
      var data = window.parent.TextEdit.getCurrentDesc();
      //document.forms['myform'].elements['elm1'].value = data;
      tinyMCE.activeEditor.setContent(data);
    }
  } 
  catch (e) {
    alert(e.message);
  }
}


tinyMCE.init({
    mode : "textareas",
    theme : "advanced",
    theme_advanced_buttons1 : "fontselect,fontsizeselect,forecolor,separator,bold,italic,underline,justifyleft,justifycenter,justifyright,justifyfull",
    theme_advanced_buttons2 : "",
    theme_advanced_buttons3 : "",
    theme_advanced_toolbar_location : "top",
    theme_advanced_toolbar_align : "left",
	theme_advanced_more_colors : 0,
	setup : function(ed) {
      ed.onInit.add(go);
    }
});



function initDesc(oForm, element_name) {

frmElement = oForm.elements[element_name];

frmElement.value = window.parent.TextEdit.getCurrentDesc();



}



function initConnection(oForm, element_name) {

frmElement = oForm.elements[element_name];

frmElement.value = dado();
alert("value: "+frmElement.value);


}


 function permission(){
        var writers = parent.TextEdit.target.parentNode.parentNode.writers;
        var own = parent.TextEdit.target.parentNode.parentNode.owner;
        
        var logged = parent.document.getElementById("owner").value;
     
      
        if(writers == null) writers == '';
        if(own != logged && writers.indexOf(logged)==-1 )
          {

             document.myform.status.disabled = true;
             document.myform.elm.disabled = true;

          }


        }


<!-- /TinyMCE -->
</script>

</head>
<body onload="initDesc(document.forms[0],'elm1');go();dado();permission();" style="background: white;" >

<form name='myform'>
	<!-- Gets replaced with TinyMCE, remember HTML in a textarea should be encoded -->
	<textarea id="elm1" name="elm1" rows="15" style="width: 90%">
	</textarea>
	<br />
        <div>
       
	<label>	Go to Task 	</label>

		<select name="status" id="status" >

                    <option value=""></option>
                    


	    </select>

	
        
	 <input type="button" name="ok" value="OK" onclick="window.parent.TextEdit.setContentDecision(tinyMCE.activeEditor.getContent(),document.forms[0].status.value);" />
	 <input type="button" name="reset" value="Cancel" onclick="window.parent.TextEdit.close()"/>
        
        </div>
</form>

</body>
</html>
